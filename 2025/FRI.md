# FRI Polynomial Commitments

> Alice FaceTimes Bob to see a large painting she’s thinking of buying from him. She asks how big it is, since she needs it to fit on a wall space with a 10-foot limit. Bob says it’s big — maybe too big — but he doesn’t know the exact dimensions. When she asks him to measure it, he says he only has a 30-centimeter wooden school ruler. He could measure it edge to edge, repositioning the ruler again and again, but that would take a while. Instead, Alice suggests a shortcut: “Just fold it in half, and keep folding it until it’s small enough to measure in one go. I’ll count the folds.” Bob folds it once, then again, and again, until the folded painting is small enough for the ruler. He measures one edge: 28 cm. Alice does the math. Given the number of folds (4), she can recover the full size — well over 10 feet. “Too big,” she says. “Shame,” Bob replies, "I ruined my painting for nothing."

## Negation Gadgets

FRI works on univariate polynomials over a finite field $\mathbb{F}_q$ for large prime $q$. They work by evaluating the polynomial $P(\square)$ at a set of evaluation points and committing to these evaluations in a Merkle tree. The domain (set of $x$ coordinates to evaluate at) is fixed and known to the prover and verifier. If the domain size is $\kappa$, we evaluate at $\omega^i$ for $i=0$ to $\kappa-1$. $\omega$ is chosen so it has order $\kappa$ in $q$ and is closed under multiplication. In math, it is called a $\kappa$-root of unity of $q$. 

### Negation of a Polynomial Evaluation Point

Next it is important to understand some basic polynomial manipulations and what the result is. The first thing to consider is $P(-\square)$. Assume that the polynomial's degree $d$ is an even number just to simplify the notation a bit:

* $P(\square) = a_0 + a_1 \square + a_2 \square^2 + a_3 \square^3 + \dots + a_d \square^d$
* $P(-\square) = a_0 - a_1 \square + a_2 \square^2 - a_3 \square^3 + \dots + a_d \square^d$

So $P(-\square)$ replicates $P(\square)$ but flips the sign of the odd terms of the polynomial. Next consider:

* $P(\square) + P(-\square) = 2a_0 + 2a_2 \square^2 + 2a_4 \square^4 + \dots + 2a_d \square^d$

This "selects" the even coefficients and gets rid of the the odd coefficients, but it also doubles the even coefficients. But if we divide by two, we get:

* $\frac{P(\square) + P(-\square)}{2} = a_0 + a_2 \square^2 + a_4 \square^4 + \dots + a_d \square^d$

So the expression $\frac{P(\square) + P(-\square)}{2}$ actually just means take the even coefficients of $P(\square)$.

If we want the odd part:

* $P(\square) - P(-\square) = 2a_1 \square + 2a_3 \square^3 + 2a_5 \square^5 + \dots + 2a_{d-1} \square^{d-1}$
* $\frac{P(\square) - P(-\square)}{2} = a_1 \square + a_3 \square^3 + a_5 \square^5 + \dots + a_{d-1} \square^{d-1}$

In fact, we can say that the original polynomial is:

$$\boxed{ P(\square) = \frac{P(\square) + P(-\square)}{2} + \frac{P(\square) - P(-\square)}{2} }$$

This is the even and odd decomposition of the polynomial.

### Negation of a Root of Unity

Above we consider how a polynomial behaves under negation: $P(-\square)$. We can also consider if there is a way to deal with negation before evaluating the polynomial, if the value we place in the $\square$ has some mathematical structure. In particular we will consider if we can simplify $P(-\boxed{\omega^i})$ before evaluating $P$ on it. 

Recall that $\omega$ has order $\kappa$ which means $\omega^i=1$  when $i=\kappa$ (thus $\omega^\kappa=1$). It also means no smaller value of $i$ will satisify the equation. In simplier terms, if try $i=0$ and then $i=1$ and then $i=2$, the *first* time $\omega^i=1$ is when $i=\kappa$. Also recall that the group is closed under multiplication.

We will consider $\kappa$ (the order of $\omega$) to be an even number. It is generally a power of two anyways, so it will be even (and also cutting it in half will not change the fact that it is even, which will be important much later). We can establish that:

```math
\begin{align*}
-\omega^i &= (-1) \cdot \omega^i \\
					&= \sqrt{(-1)^2} \cdot \omega^i \\
          &= \sqrt{1} \cdot \omega^i \\
          &= \sqrt{\omega^\kappa} \cdot \omega^i \\
          &= \omega^{\kappa/2} \cdot \omega^i \\
          &= \omega^{i + (\kappa/2)}
\end{align*}
```

What does this mean? It means that $-\omega^{i}$ is $\omega^i$ "shifted over" by $\kappa/2$.

$$\boxed{-\omega^i = \omega^{i + (\kappa/2)} }$$

We can put this together with the even/odd decomposition and form:

$$\boxed{P(\omega^i) = P_\mathsf{even}(\omega^i)+ P_\mathsf{odd}(\omega^i) = \frac{P(\omega^i) + P(\omega^{i + \kappa/2})}{2}+\frac{P(\omega^i) - P(\omega^{i + \kappa/2})}{2}}$$

### Worked Example

Let's put together a bunch of the above ideas and visualize it for an example polynomial:

* Prime field: $p = 786433$

- Primitive 32nd root of unity: $\omega = 362821$
- Degree 8 Polynomial:  $P(\square)=752738+330733 \square+144074 \square^2+185689 \square^3+179615 \square^4+499491 \square^5+435386 \square^6+389443 \square^7+200841 \square^8$

---

##### Table 1: Example

| $i$  | $\omega^i$ | $P(\omega^i)$ | $c_0 \cdot \square^0$ | $c_1 \cdot \square^1$ | $c_2 \cdot \square^2$ | $c_3 \cdot \square^3$ | $c_4 \cdot \square^4$ | $c_5 \cdot \square^5$ | $c_6 \cdot \square^6$ | $c_7 \cdot \square^7$ | $c_8 \cdot \square^8$ | $c_9 \cdot \square^9$ | $c_{10} \cdot \square^{10}$ | $c_{11} \cdot \square^{11}$ | $c_{12} \cdot \square^{12}$ | $c_{13} \cdot \square^{13}$ | $c_{14} \cdot \square^{14}$ | $c_{15} \cdot \square^{15}$ | $c_{16} \cdot \square^{16}$ | $c_{17} \cdot \square^{17}$ | $c_{18} \cdot \square^{18}$ | $c_{19} \cdot \square^{19}$ | $c_{20} \cdot \square^{20}$ | $c_{21} \cdot \square^{21}$ | $c_{22} \cdot \square^{22}$ | $c_{23} \cdot \square^{23}$ | $c_{24} \cdot \square^{24}$ | $c_{25} \cdot \square^{25}$ | $c_{26} \cdot \square^{26}$ | $c_{27} \cdot \square^{27}$ | $c_{28} \cdot \square^{28}$ | $c_{29} \cdot \square^{29}$ | $c_{30} \cdot \square^{30}$ | $c_{31} \cdot \square^{31}$ | $c_{32} \cdot \square^{32}$ |
| ---- | ---------- | ------------- | --------------------- | --------------------- | --------------------- | --------------------- | --------------------- | --------------------- | --------------------- | --------------------- | --------------------- | --------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- |
| 0    | 1          | 758711        | 752738                | 330733                | 144074                | 185689                | 179615                | 499491                | 435386                | 389443                | 200841                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 1    | 116823     | 759193        | 752738                | 554402                | 556226                | 99587                 | 241791                | 171795                | 379650                | 52343                 | 309960                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 2    | 641480     | 444709        | 752738                | 215131                | 56648                 | 590778                | 71510                 | 421944                | 89205                 | 20462                 | 585592                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 3    | 417470     | 734111        | 752738                | 209432                | 635842                | 411396                | 29274                 | 732224                | 45041                 | 587423                | 476473                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 4    | 241748     | 421848        | 752738                | 543906                | 382875                | 317415                | 606818                | 331851                | 757275                | 460294                | 200841                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 5    | 131141     | 578964        | 752738                | 89970                 | 483368                | 425282                | 544642                | 429070                | 979                   | 688687                | 309960                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 6    | 570203     | 750741        | 752738                | 674698                | 33565                 | 508192                | 714923                | 174153                | 647740                | 591305                | 585592                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 7    | 377103     | 765837        | 752738                | 783462                | 313526                | 456696                | 757159                | 584253                | 537801                | 35894                 | 476473                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 8    | 686408     | 8686          | 752738                | 522253                | 642359                | 354064                | 179615                | 501215                | 351047                | 436719                | 200841                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 9    | 387372     | 378258        | 752738                | 476512                | 230207                | 229297                | 241791                | 552608                | 406783                | 324094                | 309960                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 10   | 245037     | 550517        | 752738                | 687904                | 729785                | 780263                | 71510                 | 551211                | 697228                | 412884                | 585592                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 11   | 582684     | 152334        | 752738                | 566454                | 150591                | 564608                | 29274                 | 586123                | 741392                | 216846                | 476473                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 12   | 398184     | 774990        | 752738                | 450857                | 403558                | 348732                | 606818                | 367789                | 29158                 | 760231                | 200841                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 13   | 323915     | 297541        | 752738                | 690002                | 303065                | 671080                | 544642                | 281359                | 785454                | 677839                | 309960                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 14   | 711817     | 754058        | 752738                | 294012                | 752868                | 21412                 | 714923                | 623558                | 138693                | 15994                 | 585592                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 15   | 744837     | 681983        | 752738                | 689034                | 472907                | 270162                | 757159                | 716338                | 248632                | 230705                | 476473                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 16   | 786432     | 307298        | 752738                | 455700                | 144074                | 600744                | 179615                | 286942                | 435386                | 396990                | 200841                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 17   | 669610     | 575805        | 752738                | 232031                | 556226                | 686846                | 241791                | 614638                | 379650                | 734090                | 309960                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 18   | 144953     | 307378        | 752738                | 571302                | 56648                 | 195655                | 71510                 | 364489                | 89205                 | 765971                | 585592                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 19   | 368963     | 785326        | 752738                | 577001                | 635842                | 375037                | 29274                 | 54209                 | 45041                 | 199010                | 476473                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 20   | 544685     | 260648        | 752738                | 242527                | 382875                | 469018                | 606818                | 454582                | 757275                | 326139                | 200841                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 21   | 655292     | 458678        | 752738                | 696463                | 483368                | 361151                | 544642                | 357363                | 979                   | 97746                 | 309960                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 22   | 216230     | 786210        | 752738                | 111735                | 33565                 | 278241                | 714923                | 612280                | 647740                | 195128                | 585592                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 23   | 409330     | 190959        | 752738                | 2971                  | 313526                | 329737                | 757159                | 202180                | 537801                | 750539                | 476473                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 24   | 100025     | 312349        | 752738                | 264180                | 642359                | 432369                | 179615                | 285218                | 351047                | 349714                | 200841                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 25   | 399061     | 358968        | 752738                | 309921                | 230207                | 557136                | 241791                | 233825                | 406783                | 462339                | 309960                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 26   | 541396     | 404591        | 752738                | 98529                 | 729785                | 6170                  | 71510                 | 235222                | 697228                | 373549                | 585592                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 27   | 203749     | 216437        | 752738                | 219979                | 150591                | 221825                | 29274                 | 200310                | 741392                | 569587                | 476473                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 28   | 388249     | 65504         | 752738                | 335576                | 403558                | 437701                | 606818                | 418644                | 29158                 | 26202                 | 200841                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 29   | 462518     | 375579        | 752738                | 96431                 | 303065                | 115353                | 544642                | 505074                | 785454                | 108594                | 309960                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 30   | 74616      | 416972        | 752738                | 492421                | 752868                | 765021                | 714923                | 162875                | 138693                | 770439                | 585592                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
| 31   | 41596      | 15237         | 752738                | 97399                 | 472907                | 516271                | 757159                | 70095                 | 248632                | 555728                | 476473                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |

Table 1 above shows the domain over $\omega^i$ in the second column ($i$ in the first column). The third column shows the evaluation. In FRI, this column is committed to. The rest of the table is not committed to but visualizing it will help us understand FRI. It shows each term of the polynomial (or "monomial" of the polynomial). The evaluation (third column) is thus the sum (mod $p$) of the monomials after it.

The number of rows is the size of the domain and the number of non-zero columns is the degree of the polynomial. Because Table 1 has a lot of zeros in the righthand side, the domain is much bigger than the degree of the polynomial. To interpolate the polynomial from the points, you would not need all the points, there are many extras. We call the polynomial a "low-degree polynomial" where low is relative to the size of the domain.

We can also examine the even and odd decomposition in action. Recall:

$$\boxed{P(\omega^i) = P_\mathsf{even}(\omega^i)+ P_\mathsf{odd}(\omega^i) = \frac{P(\omega^i) + P(\omega^{i + \kappa/2})}{2}+\frac{P(\omega^i) - P(\omega^{i + \kappa/2})}{2}}$$

In this case, $\kappa=32$ therefore $P(\omega^{i + \kappa/2})=P(\omega^{i+16})$. The even decomposition is in the last row:

| $P_\mathsf{even}(\omega^i)$                | $c_0 \cdot \square^0$ | $c_1 \cdot \square^1$ | $c_2 \cdot \square^2$ | $c_3 \cdot \square^3$ | $c_4 \cdot \square^4$ | $c_5 \cdot \square^5$ | $c_6 \cdot \square^6$ | $c_7 \cdot \square^7$ | $c_8 \cdot \square^8$ |
| ------------------------------------------ | --------------------- | --------------------- | --------------------- | --------------------- | --------------------- | --------------------- | --------------------- | --------------------- | --------------------- |
| $\boxed{\omega^0}=\boxed{1}$               | 752738                | 330733                | 144074                | 185689                | 179615                | 499491                | 435386                | 389443                | 200841                |
| $\boxed{\omega^{16}}=\boxed{786432}$       | 752738                | 455700                | 144074                | 600744                | 179615                | 286942                | 435386                | 396990                | 200841                |
| $\boxed{\omega^0}+\boxed{\omega^{16}}$     | 719043                | 0                     | 288148                | 0                     | 359230                | 0                     | 84339                 | 0                     | 401682                |
| $(\boxed{\omega^0}+\boxed{\omega^{16}})/2$ | 752738                | 0                     | 144074                | 0                     | 179615                | 0                     | 435386                | 0                     | 200841                |

The odd decomposition is in the last row:

| $P_\mathsf{odd}(\omega^i)$                 | $c_0 \cdot \square^0$ | $c_1 \cdot \square^1$ | $c_2 \cdot \square^2$ | $c_3 \cdot \square^3$ | $c_4 \cdot \square^4$ | $c_5 \cdot \square^5$ | $c_6 \cdot \square^6$ | $c_7 \cdot \square^7$ | $c_8 \cdot \square^8$ |
| ------------------------------------------ | --------------------- | --------------------- | --------------------- | --------------------- | --------------------- | --------------------- | --------------------- | --------------------- | --------------------- |
| $\boxed{\omega^0}=\boxed{1}$               | 752738                | 330733                | 144074                | 185689                | 179615                | 499491                | 435386                | 389443                | 200841                |
| $\boxed{\omega^{16}}=\boxed{786432}$       | 752738                | 455700                | 144074                | 600744                | 179615                | 286942                | 435386                | 396990                | 200841                |
| $\boxed{\omega^0}-\boxed{\omega^{16}}$     | 0                     | 661466                | 0                     | 371378                | 0                     | 212549                | 0                     | 778886                | 0                     |
| $(\boxed{\omega^0}-\boxed{\omega^{16}})/2$ | 0                     | 330733                | 0                     | 185689                | 0                     | 499491                | 0                     | 389443                | 0                     |

## Squaring Gadgets

### Square of Polynomial Evaluation

Above we looked at what $P(-\square)$ looks like. Now we look at what $P(\square^2)$ looks like. Consider a slightly smaller example than the one above, a degree 4 polynomial:

$P(\square) = c_0 + c_1 \square + c_2 \square^2 + c_3 \square^3 + c_4 \square^4$

$P(\square^2) = Q(\square)= c_0 + c_1 \square^2 + c_2 \square^4 + c_3 \square^6 + c_4 \square^8$

To visualize it, consider each term of the polynomial:

| Degree (power of $\square$) | 0                     | 1                     | 2                     | 3                     | 4                     | 5    | 6                   | 7    | 8               |
| --------------------------- | --------------------- | --------------------- | --------------------- | --------------------- | --------------------- | ---- | ------------------- | ---- | --------------- |
| $P(\square)$                | $c_0 \cdot \square^0$ | $c_1 \cdot \square^1$ | $c_2 \cdot \square^2$ | $c_3 \cdot \square^3$ | $c_4 \cdot \square^4$ | $0$  | $0$                 | $0$  | $0$             |
| $P(\square^2)$              | $c_0 \cdot \square^0$ | $0$                   | $c_1 \cdot \square^2$ | $0$                   | $c_2 \square^4$       | $0$  | $c_3\cdot\square^6$ | $0$  | $c_4 \square^8$ |

Observe that $P(\square^2)$ "stretches out" the coefficients leaving 0's in between each term of the polynomial.

We can do the opposite transformation as well: $Q(\sqrt{\square}) = P(\square)$. This reverses the stretching process by replacing each $\square^{2i}$ in $Q$ with $\square^i$:

$Q(\square) = c_0 + c_1 \square^2 + c_2 \square^4 + c_3 \square^6 + c_4 \square^8$

$Q(\sqrt{\square}) = c_0 + c_1 \square + c_2 \square^2 + c_3 \square^3 + c_4 \square^4 = P(\square)$

This only works cleanly because $Q(\square)$ had only even powers. If $Q$ had odd powers, then $Q(\sqrt{\square})$ would contain fractional exponents like $\square^{1/2}$, which are not allowed in polynomials. So, the inverse transformation $P(\square) = Q(\sqrt{\square})$ is valid only when $Q(\square)$ contains only even-degree terms.

| Degree (power of $\square$) | 0                     | 1                     | 2                     | 3                     | 4                     | 5    | 6                   | 7    | 8               |
| --------------------------- | --------------------- | --------------------- | --------------------- | --------------------- | --------------------- | ---- | ------------------- | ---- | --------------- |
| $Q(\square)$                | $c_0 \cdot \square^0$ | $0$                   | $c_1 \cdot \square^2$ | $0$                   | $c_2 \square^4$       | $0$  | $c_3\cdot\square^6$ | $0$  | $c_4 \square^8$ |
| $Q(\sqrt{\square})$         | $c_0 \cdot \square^0$ | $c_1 \cdot \square^1$ | $c_2 \cdot \square^2$ | $c_3 \cdot \square^3$ | $c_4 \cdot \square^4$ | $0$  | $0$                 | $0$  | $0$             |

Observe that this transformation "squeezes" the width of the table, adding 0's to the right hand side. It also means that the new polynomial has half the degree of the previous polynomial.

### Square of a Root of Unity

We now examine what happens when we square the evaluation points themselves. Recall that the domain is a set of powers of a root of unity (the order of which is a power of 2):

$$
D = \{ \omega^i \mid i = 0, 1, 2, \dots, \kappa - 1 \}
$$

Now consider what happens if we evaluate the polynomial not at $\omega^i$, but at $(\omega^i)^2 = \omega^{2i}$:

$$
D^{(1)} = \{ \omega^{2i} \mid i = 0, 1, 2, \dots, \kappa/2 - 1 \}
$$

Since $\omega$ is a $\kappa$-th root of unity, $\omega^{\kappa} = 1$, and the powers "wrap around" every $\kappa$ steps. But the set $\{ \omega^{2i} \}$ is a subgroup of the original domain and has only $\kappa/2$ elements. So squaring the elements of the domain cuts the domain size in half. We can always cut evenly in half because we will choose $\kappa$ (the order of $\omega$ in $\mathbb{F}_p$) as a perfect power of 2. 

Let’s say $\omega$ is an 8th root of unity, so $\kappa = 8$:

|                | $i = 0$    | $i = 1$    | $i = 2$    | $i = 3$    | $i = 4$    | $i = 5$    | $i = 6$    | $i = 7$    |
| -------------- | ---------- | ---------- | ---------- | ---------- | ---------- | ---------- | ---------- | ---------- |
| $\omega^i$     | $\omega^0$ | $\omega^1$ | $\omega^2$ | $\omega^3$ | $\omega^4$ | $\omega^5$ | $\omega^6$ | $\omega^7$ |
| $(\omega^i)^2$ | $\omega^0$ | $\omega^2$ | $\omega^4$ | $\omega^6$ | $\omega^0$ | $\omega^2$ | $\omega^4$ | $\omega^6$ |

Notice how squaring "collapses" the 8-point domain into just 4 unique values: $\{ \omega^0, \omega^2, \omega^4, \omega^6 \}$.

## FRI

We are now ready to describe FRI which stands for Fast Reed–Solomon Interactive Oracle Proofs of Proximity. It is like a polynomial commitment scheme (locks in a polynomial) and what makes it better than just hashing the polynomial is that certain properties of the polynomial can be shown succinctly (in less time/space than revealing the polynomial).

If you are familiar with KZG polynomial commitments, you know that KZG allows you to succinctly prove the opening of the polynomial at any evaluation point. In FRI, the polynomial can only be opened at a pre-determined at a point $\omega^i$. However in FRI, the main objective is to prove that the committed polynomial has low degree.

For technical reasons, FRI is a little "fuzzy." You can commit to a function and show that is close to a low-degree polynomial.

### Merkle Tree

Unlike KZG, in FRI we do not commit to the polynomial's coefficients. Instead we commit to the evaluation of the polynomial on each point in the domain $D = \{ \omega^0, \omega^1, \dots, \omega^{\kappa - 1}\}$: 

$$
\langle P(\omega^0), P(\omega^1), \dots, P(\omega^{\kappa - 1})\rangle
$$

This is called the evaluation vector. It is committed to using a Merkle tree, with each leaf containing one evaluation value. The root of the Merkle tree serves as a commitment to the entire function. I assume you are familiar with Merkle trees already and understand that the prover can show a committed evaluation point by sending $\log{\kappa}$ values (the Merkle path).

In the worked example above, this corresponds to "column 3" of the large Table 1.

### Folding: Low Degree Proof

The prover also claims that the committed polynomial is "low" degree \( $d \ll \kappa$ \). While the verifier could open many evaluation points and interpolate the results into the original polynomial, this approach is not succinct for the verifier. So we need to do something else.

Look again at Table 1 in the working example that shows all the terms of the polynomial. In FRI, a simple way of looking at what we want to prove is that the righthand side of this table contains columns and columns of zeros. We need to do this without having actually committed to all the columns however, we only committed to the third column. 

Recall that under the squaring gadgets, we saw a technique that can "squeeze" a polynomial that halves (roughly) the degree. We also saw that if we square the evaluation points, we can halve the domain. We will do something similar, applying the operation a logarithmic number of times (in $\log_2 d$), with each step reducing the effective degree by approximately half.

The idea of folding is to repeat a "folding" operation that creates new polynomials, each halve the degree of the previous polynomial and committed to at half the number of points (thus half the domain). Although we are not committing to each term of the polynomial, the underlying data would look Table 1 getting smaller and smaller, both in number of rows and number of columns. Finally, the folding would preserve the block of 0's on the righthand side (and, conversely, if there were any non-zero terms, these would spread as we fold).

Eventually, after enough ($\log_2 d$) steps, the degree shrinks down to 1. At this point, the verifier can step in and check that the final polynomial is indeed degree 1 — a task that requires only a small number of queries and no interpolation.

### How do we fold?

We need to transform the original $P(\square)$ (which we will denote $P^{(0)}(\square)$) into a new polynomial $P^{(1)}(\square)$ with half the degree, and evaluate it over half the domain. The superscript $j$ in $P^{(j)}(\square)$ will be used to keep track of the round of folding we are on.

How do we evaluate on half the domain? Since we are not directly committing to the polynomial itself (e.g., by its coefficients) and instead by a domain of evaluation points, we can just choose half of them. The issue is that we want to preserve the properties of the domain we get from choosing a root of unity (i.e., the domain is closed under multiplication). So we need to pick a new root of unity $\omega_{(1)}$ that has order $\kappa/2$. We saw how to do this already. If we square the current $\omega$, we can use it as the generator for a group of half the size: $\omega_{(j+1)}={\omega_{(j)}}^2$. So every round, we pick a new generator for the domain and evaluate the new folded polynomial (which we will describe next) on this domain, again committing to it in a Merkle tree.

#### Attempt 1

The next challenge is how we create a new polynomial $P^{(1)}(\square)$ with half the degree of $P^{(0)}(\square)$. We saw earlier that we can isolate all the even coefficients or all the odd coefficients. One idea is to somehow drop the odd coefficients and keep the even coefficients, and then map $P^{(0)}(\sqrt\square)\rightarrow P^{(1)}({\square})$. This shrinks the degree of the polynomial. This is how it would look:

|      |       |                                          | $c_0 \cdot \square^0$ | $c_1 \cdot \square^1$ | $c_2 \cdot \square^2$ | $c_3 \cdot \square^3$ | $c_4 \cdot \square^4$ | $c_5 \cdot \square^5$ | $c_6 \cdot \square^6$ | $c_7 \cdot \square^7$ | $c_8 \cdot \square^8$ | $c_9 \cdot \square^9$ | $c_{10} \cdot \square^{10}$ | $c_{11} \cdot \square^{11}$ | $c_{12} \cdot \square^{12}$ | $c_{13} \cdot \square^{13}$ | $c_{14} \cdot \square^{14}$ | $c_{15} \cdot \square^{15}$ | $c_{16} \cdot \square^{16}$ | $c_{17} \cdot \square^{17}$ | $c_{18} \cdot \square^{18}$ | $c_{19} \cdot \square^{19}$ | $c_{20} \cdot \square^{20}$ | $c_{21} \cdot \square^{21}$ | $c_{22} \cdot \square^{22}$ | $c_{23} \cdot \square^{23}$ | $c_{24} \cdot \square^{24}$ | $c_{25} \cdot \square^{25}$ | $c_{26} \cdot \square^{26}$ | $c_{27} \cdot \square^{27}$ | $c_{28} \cdot \square^{28}$ | $c_{29} \cdot \square^{29}$ | $c_{30} \cdot \square^{30}$ | $c_{31} \cdot \square^{31}$ | $c_{32} \cdot \square^{32}$ |
| ---- | ----- | ---------------------------------------- | --------------------- | --------------------- | --------------------- | --------------------- | --------------------- | --------------------- | --------------------- | --------------------- | --------------------- | --------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- | --------------------------- |
|      | $i=0$ | $P(\omega^i)$                            | 752738                | 330733                | 144074                | 185689                | 179615                | 499491                | 435386                | 389443                | 200841                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
|      |       | $P_\mathsf{even}(\omega^i)$              | 752738                | 0                     | 144074                | 0                     | 179615                | 0                     | 435386                | 0                     | 200841                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
|      |       | $P(\sqrt{\omega^i})$                     | 752738                | 144074                | 179615                | 435386                | 200841                | 0                     | 0                     | 0                     | 0                     | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           |
|      |       | ${\hat{M}(\omega^i)}\approx P(\omega^i)$ | 752738                | 330733                | 144074                | 185689                | 179615                | 499491                | 435386                | 389443                | 200841                | 0                     | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | 0                           | **23984**                   | 0                           | 0                           | 0                           | 0                           | 0                           |

However this does not quite work. Consider a malicious polynomial $\hat{M}(\square)$. What is its degree? If you scroll right, you notice it has a non-zero coefficient at $c_{27}$. The problem is that when we fold, this is an odd coefficient and it just disappears. The idea of folding is that if the polynomial in the current round has degree, say, 4, then in the previous round it had degree at most 8. And in the round before, at most 16.

We want to fold in a way that preserves all the 0's above the degree of the polynomial and conversely, if a non-zero term is there, it should "pollute" the 0's as we fold.

#### Attempt 2

Instead of throwing away the odd coefficient terms, maybe we can combine them with the even ones. For example, we could add them together:

$$P^{(j+1)}(\square) = P^{(j)}_\mathsf{even}(\sqrt{\square}) + P^{(j)}_\mathsf{odd}(\sqrt{\square})$$

If adjacent terms are 0, there sum is 0 so the 0's will stay as 0's. However if a term is non-zero, the sum of it with its adjacent term will be non-zero. 

Or will it? It is possible to place to terms next to each that "cancel out". For example if $\hat{M}(\square)$ above had $c_{26} \cdot \square^{26}=-23984$ and $c_{27} \cdot \square^{27}=+23984$, then adding them together would result in a 0 that would carry through to future rounds. 

#### Attempt 3

The final attempt is to combine the even terms and odd terms in a way that:

* Two 0 values will map to 0
* A non-zero value and another value will map to a non-zero value
* There is enough mathematical "structure" that the verifier can follow along

What FRI does is relax the second condition to be: a non-zero value and another value will map to a non-zero value with *high probability*. The prover will commit to the polynomial $P^{(j)}(\square)$ for round $i$. And then the verifier will choose a random value $\beta$ from the field $\mathbb{F}_p$ and ask for the folding step to be:

$${P^{(j+1)}(\square) = P^{(j)}_\mathsf{even}(\sqrt{\square}) + \beta \cdot P^{(j)}_\mathsf{odd}(\sqrt{\square})}$$

The verifier could try and hide high degree terms amongst the 0's but the chance that their different would be exactly $\beta$ is overwhelmingly low ($1/p$ where $p$ is a large prime). However it is **critical** that $\beta$ is unknown and unpredictable to the prover. 

Now the last "weird" thing about the folding equation is the square roots. What do they mean exactly? It is easier to move them to the other side of the equation, and remember that we are not committing to the polynomial exactly, we are committing to set of evaluation points. Think like a programmer. What you will do is choose a new generator $\omega_{(j+1)}={\omega_{(j)}}^2$ and generate the domain (rows in Table 1), which will be half the size of the previous domain. For each evaluation point in the new domain, you will "set" its evaluation to be the folded value from the previous round. 

$$\boxed{P^{(i+1)}(\square^2) \leftarrow P^{(i)}_\mathsf{even}(\square) + \beta \cdot P^{(i)}_\mathsf{odd}(\square)}$$

#### Worked Example

